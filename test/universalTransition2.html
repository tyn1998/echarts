<!DOCTYPE html>
<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->


<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <script src="lib/simpleRequire.js"></script>
        <script src="lib/config.js"></script>
        <script src="lib/jquery.min.js"></script>
        <script src="lib/facePrint.js"></script>
        <script src="lib/testHelper.js"></script>
        <!-- <script src="ut/lib/canteen.js"></script> -->
        <link rel="stylesheet" href="lib/reset.css" />
    </head>
    <body>
        <style>
        </style>



        <div id="main0"></div>
        <div id="main1"></div>
        <div id="main2"></div>
        <div id="main3"></div>


        <script>
            window.ANIMATION_DURATION_UPDATE = 1000;
        </script>



        <script>
        require([
            'echarts',
            // 'map/js/china',
            // './data/nutrients.json'
        ], function (echarts) {
            var option;

            option = {
                xAxis: {
                    data: ['Animals', 'Fruits', 'Cars']
                },
                yAxis: {},
                animationDurationUpdate: ANIMATION_DURATION_UPDATE,
                series: {
                    dataGroupId: '',
                    type: 'bar',
                    id: 'main',
                    data: [{
                        value: 5,
                        groupId: 'animals'
                    }, {
                        value: 2,
                        groupId: 'fruits'
                    }, {
                        value: 4,
                        groupId: 'cars'
                    }],
                    universalTransition: {
                        enabled: true
                    }
                }
            };

            const drilldownData = [{
                dataGroupId: 'animals',
                data: [
                    ['Cats', 4],
                    ['Dogs', 2],
                    ['Cows', 1],
                    ['Sheep', 2],
                    ['Pigs', 1]
                ]
            }, {
                dataGroupId: 'fruits',
                data: [
                    ['Apples', 4],
                    ['Oranges', 2]
                ]
            }, {
                dataGroupId: 'cars',
                data: [
                    ['Toyota', 4],
                    ['Opel', 2],
                    ['Volkswagen', 2]
                ]
            }];

            var chart = testHelper.create(echarts, 'main0', {
                title: [
                    'Drilldown of bar chart.'
                ],
                recordVideo: true,
                option: option
                // height: 300,
                // buttons: [{text: 'btn-txt', onclick: function () {}}],
            });

            chart.on('click', function (event) {
                if (event.data) {
                    const subData = drilldownData.find(data => {
                        return data.dataGroupId === event.data.groupId;
                    });
                    if (!subData) {
                        return;
                    }
                    chart.setOption({
                        xAxis: {
                            data: subData.data.map(item => item[0])
                        },
                        yAxis: {},
                        animationDurationUpdate: ANIMATION_DURATION_UPDATE,
                        series: {
                            type: 'bar',
                            id: 'main',
                            dataGroupId: subData.dataGroupId,
                            data: subData.data.map(item => item[1]),
                            universalTransition: {
                                enabled: true
                            }
                        },
                        graphic: [{
                            type: 'text',
                            left: 50,
                            top: 20,
                            style: {
                                text: 'Back',
                                fontSize: 18
                            },
                            onclick() {
                                chart.setOption(option, {
                                    replaceMerge: ['xAxis', 'yAxis']
                                });
                            }
                        }]
                    }, {
                        replaceMerge: ['xAxis', 'yAxis']
                    });
                }
            });
        });
        </script>

        <script>

            require([
                'echarts', 'ecStat', 'ecSimpleTransform'
            ], function (echarts, ecStat, ecSimpleTransform) {

                echarts.registerTransform(ecSimpleTransform.aggregate);
                echarts.registerTransform(ecStat.transform.clustering);
                echarts.registerTransform(ecSimpleTransform.id);

                const RAW_DATA = [[1425139200000,34,0.13,2,"MD","ZD","P0"],[1425225600000,28,0.71,1.5,"MB","ZD","P1"],[1425312000000,23,0.9,2.8,"MA","ZC","P2"],[1425398400000,21,0.58,6,"MB","ZC","P3"],[1425484800000,14,0.1,1.6,"MC","ZA","P4"],[1425571200000,21,0.6,7.7,"MC","ZA","P5"],[1425657600000,23,0.31,2.6,"MC","ZC","P6"],[1425744000000,34,0.74,2.4,"MD","ZE","P7"],[1425830400000,14,0.59,2.3,"MB","ZD","P8"],[1425916800000,18,0.85,5.1,"MB","ZB","P9"],[1426003200000,36,0.96,1.2,"MC","ZC","P10"],[1426089600000,18,0.28,2.5,"MA","ZC","P11"],[1426176000000,20,0.62,6,"MB","ZD","P12"],[1426262400000,32,0.79,1.7,"MB","ZA","P13"],[1426348800000,17,0.58,4.4,"MD","ZB","P14"],[1426435200000,23,0.77,3,"MB","ZA","P15"],[1426521600000,39,0.87,4.6,"MC","ZA","P16"],[1426608000000,15,0.7,6,"MB","ZC","P17"],[1426694400000,21,0.94,2.7,"MB","ZD","P18"],[1426780800000,28,0.48,4.5,"MC","ZC","P19"],[1426867200000,31,0.49,9.8,"MA","ZC","P20"],[1426953600000,27,0.87,7.7,"MB","ZB","P21"],[1427040000000,27,0.82,5.5,"MC","ZB","P22"],[1427126400000,11,0.53,2.7,"MD","ZC","P23"],[1427212800000,13,0.7,7.6,"MB","ZD","P24"],[1427299200000,39,0.99,4.8,"MB","ZD","P25"],[1427385600000,32,0.91,2.1,"MB","ZE","P26"],[1427472000000,20,0.97,5,"MB","ZA","P27"],[1427558400000,36,0.01,8.9,"MB","ZD","P28"],[1427644800000,22,0.08,9.2,"MB","ZE","P29"],[1427731200000,21,0.36,3.1,"MD","ZC","P30"],[1427817600000,11,0.15,5.8,"MD","ZB","P31"],[1427904000000,39,0.02,1.4,"MC","ZD","P32"],[1427990400000,20,0.86,8.7,"MB","ZD","P33"],[1428076800000,23,0.24,7.2,"MD","ZB","P34"],[1428163200000,12,0.06,2,"MD","ZB","P35"],[1428249600000,36,0.42,8.2,"MA","ZB","P36"],[1428336000000,17,0.48,7.5,"MB","ZC","P37"],[1428422400000,19,0.12,6.6,"MB","ZB","P38"],[1428508800000,39,0.58,3.1,"MC","ZE","P39"],[1428595200000,10,0.18,6.6,"MC","ZD","P40"],[1428681600000,22,0.28,2.1,"MB","ZE","P41"],[1428768000000,27,0.33,1.9,"MC","ZB","P42"],[1428854400000,37,0.46,9.4,"MD","ZE","P43"],[1428940800000,18,0.96,5.5,"MB","ZA","P44"],[1429027200000,11,0.61,8.2,"MD","ZC","P45"],[1429113600000,15,0.88,4.6,"MD","ZA","P46"],[1429200000000,38,0.89,7.2,"MD","ZC","P47"],[1429286400000,20,0.39,5.4,"MB","ZB","P48"],[1429372800000,30,0.71,5.5,"MA","ZA","P49"]];
                const RAW_DATA_DIMENSIONS = ['DATE', 'COUNT', 'PRICE', 'WEIGHT', 'M_TAG', 'Z_TAG', 'ID'];


                const datasetOption = [{
                    id: 'raw_dataset',
                    dimensions: RAW_DATA_DIMENSIONS,
                    source: RAW_DATA
                }, {
                    id: 'raw_clustered_dataset',
                    fromDatasetId: 'raw_dataset',
                    transform: {
                        type: 'ecStat:clustering',
                        config: {
                            clusterCount: 4,
                            dimensions: ['COUNT', 'PRICE'],
                            outputClusterIndexDimension: {
                                index: RAW_DATA_DIMENSIONS.length,
                                name: 'CLUSTER_IDX'
                            },
                            outputCentroidDimensions: [{
                                index: RAW_DATA_DIMENSIONS.length + 1,
                                name: 'CLUSTER_CENTER_COUNT'
                            }, {
                                index: RAW_DATA_DIMENSIONS.length + 2,
                                name: 'CLUSTER_CENTER_PRICE'
                            }]
                        }
                    }
                }, {
                    id: 'raw_cluster_centers_dataset',
                    fromDatasetId: 'raw_clustered_dataset',
                    transform: {
                        type: 'ecSimpleTransform:aggregate',
                        config: {
                            resultDimensions: [
                                { from: 'COUNT', method: 'count' },
                                { from: 'CLUSTER_CENTER_COUNT', method: 'first' },
                                { from: 'CLUSTER_CENTER_PRICE', method: 'first' },
                                { from: 'CLUSTER_IDX' }
                            ],
                            groupBy: 'CLUSTER_IDX'
                        }
                    }
                }];

                const rawScatterOption = {
                    dataset: datasetOption,
                    xAxis: {
                        name: 'PRICE'
                    },
                    yAxis: {
                        name: 'COUNT'
                    },
                    animationDurationUpdate: ANIMATION_DURATION_UPDATE,
                    series: {
                        type: 'scatter',
                        id: 'main',
                        datasetId: 'raw_clustered_dataset',
                        symbolSize: 20,
                        encode: {
                            itemName: 'ID',
                            x: 'PRICE',
                            y: 'COUNT',
                            itemGroupId: 'CLUSTER_IDX',
                            tooltip: ['PRICE', 'COUNT', 'WEIGHT']
                        },
                        universalTransition: {
                            enabled: true
                        }
                    }
                };

                const clusteredScatterOption = {
                    dataset: datasetOption,
                    xAxis: {
                        name: 'PRICE'
                    },
                    yAxis: {
                        name: 'COUNT'
                    },
                    animationDurationUpdate: ANIMATION_DURATION_UPDATE,
                    series: {
                        type: 'scatter',
                        id: 'main',
                        datasetId: 'raw_cluster_centers_dataset',
                        symbolSize: 50,
                        encode: {
                            x: 'CLUSTER_CENTER_PRICE',
                            y: 'CLUSTER_CENTER_COUNT',
                            itemGroupId: 'CLUSTER_IDX',
                            tooltip: ['CLUSTER_CENTER_PRICE', 'CLUSTER_CENTER_COUNT']
                        },
                        universalTransition: {
                            enabled: true,
                            divideShape: 'clone'
                        }
                    }
                }

                var chart = testHelper.create(echarts, 'main1', {
                    title: [
                        'Transition of cluster',
                        `Use divideShape: 'clone'`
                    ],
                    option: rawScatterOption,
                    recordVideo: true,
                    // height: 300,
                    buttons: [{
                        text: 'All',
                        onclick: function () {
                            chart.setOption(rawScatterOption);
                        }
                    }, {
                        text: 'Clustered',
                        onclick: function () {
                            chart.setOption(clusteredScatterOption);
                        }
                    }],
                });
            });
        </script>

        <script>
            require([
                'echarts'
            ], function (echarts) {

                const femaleData = [['female', 161.2, 51.6], ['female', 167.5, 59.0], ['female', 159.5, 49.2], ['female', 157.0, 63.0], ['female', 155.8, 53.6],
                    ['female', 170.0, 59.0], ['female', 159.1, 47.6], ['female', 166.0, 69.8], ['female', 176.2, 66.8], ['female', 160.2, 75.2],
                ];
                const maleDeta = [[174.0, 65.6, 23, 'male'], [175.3, 71.8, 23, 'male'], [193.5, 80.7, 23, 'male'], [186.5, 72.6, 23, 'male'], [187.2, 78.8, 23, 'male'],
                    [181.5, 74.8, 23, 'male'], [184.0, 86.4, 23, 'male'], [184.5, 78.4, 23, 'male'], [175.0, 62.0, 23, 'male'], [184.0, 81.6, 23, 'male'],
                ];

                function calculateAverage(data, dim) {
                    let total = 0;
                    for (let i = 0; i < data.length; i++) {
                        total += data[i][dim];
                    }
                    return total /= data.length;
                }

                const scatterOption = {
                    xAxis: {
                        scale: true
                    },
                    yAxis: {
                        scale: true
                    },
                    series: [{
                        type: 'scatter',
                        id: 'female',
                        encode: {
                            x: 1,
                            y: 2,
                            itemGroupId: 0
                        },
                        universalTransition: {
                            enabled: true,
                            delay(idx, count) {
                                return (idx / count) * 1000;
                            }
                        },
                        data: femaleData
                    }, {
                        type: 'scatter',
                        id: 'male',
                        encode: {
                            x: 0,
                            y: 1,
                            itemGroupId: 3,
                        },
                        universalTransition: {
                            enabled: true,
                            delay(idx, count) {
                                return (idx / count) * 1000;
                            }
                        },
                        data: maleDeta
                    }]
                };

                const barOption = {
                    xAxis: {
                        type: 'category',
                        data: ['Female', 'Male']
                    },
                    yAxis: {},
                    series: [{
                        type: 'bar',
                        id: 'total',
                        data: [{
                            value: calculateAverage(maleDeta, 0),
                            groupId: 'male'
                        }, {
                            value: calculateAverage(femaleData, 1),
                            groupId: 'female'
                        }],
                        universalTransition: {
                            enabled: true,
                            seriesKey: ['female', 'male'],
                            delay(idx, count) {
                                return (idx / count) * 1000;
                            }
                        }
                    }]
                };

                calculateAverage(femaleData, 1);
                var chart = testHelper.create(echarts, 'main2', {
                    title: [
                        'Animation delay for each individuals.'
                    ],
                    recordVideo: true,
                    option: scatterOption,
                    // height: 300,
                    buttons: [{
                        text: 'Scatter',
                        onclick: function () {
                            chart.setOption(scatterOption, true);
                        }
                    }, {
                        text: 'Bar',
                        onclick: function () {
                            chart.setOption(barOption, true);
                        }
                    }],
                });
            });
        </script>
    </body>
</html>

